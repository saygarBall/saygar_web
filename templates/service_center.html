{% extends "base.html" %}

{% block title %}{{ service_name }} - ‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£{% endblock %}

{% block content %}
<h1 class="mb-3 text-primary">üìç ‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏±‡∏ö‡∏ä‡∏°‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤: {{ service_name }}</h1>
<div id="clockbox" class="mb-3 fw-bold"></div>

<script>
    const tday = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
    const tmonth = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
    function GetClock() {
        const d = new Date();
        let nhour = d.getHours();
        const nmin = d.getMinutes().toString().padStart(2, '0');
        const nsec = d.getSeconds().toString().padStart(2, '0');
        const ap = nhour < 12 ? " AM" : " PM";
        if (nhour === 0) nhour = 12;
        else if (nhour > 12) nhour -= 12;
        document.getElementById('clockbox').innerHTML = `${tday[d.getDay()]}, ${tmonth[d.getMonth()]} ${d.getDate()}, ${d.getFullYear()} ${nhour}:${nmin}:${nsec}${ap}`;
        setTimeout(GetClock, 1000);
    }
    window.onload = GetClock;
</script>

{% if greeting %}
<div class="alert alert-info">
    {{ greeting }}
    {% if greeting == "‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å" %}
        <a href="{{ url_for('login') }}" class="btn btn-primary btn-sm ms-2">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
        <a href="{{ url_for('register') }}" class="btn btn-outline-secondary btn-sm ms-1">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</a>
    {% else %}
        <a href="{{ url_for('account') }}" class="btn btn-success btn-sm ms-2">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</a>
        {% if 'user_id' in session and user.rank == 'user_administrator_and_manage_systems' %}
            <a href="{{ url_for('manage_users') }}" class="btn btn-warning btn-sm ms-1">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</a>
        {% endif %}
    {% endif %}
</div>
{% endif %}

<div class="card mb-4">
    <div class="card-header bg-light">
        üìù ‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏π‡∏î‡∏Ñ‡∏∏‡∏¢
    </div>
    <div class="card-body">
        <form action="{{ url_for('post_service_center', service_id=service_id) }}" method="POST" enctype="multipart/form-data">
            <label for="title" class="form-label">‡∏´‡∏±‡∏ß‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á:</label>
            <input type="text" id="title" name="title" class="form-control" required>

            <label for="content" class="form-label mt-3">‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤:</label>
            <textarea id="content" name="content" rows="4" class="form-control" required></textarea>

            <label for="image" class="form-label mt-3">‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ):</label>
            <input type="file" id="image" name="image" class="form-control" multiple>

            <button type="submit" class="btn btn-primary mt-3">üì® ‡πÇ‡∏û‡∏™‡∏ï‡πå</button>
        </form>
    </div>
</div>

<div class="mb-4">
    <h2 class="text-success">üìò ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏à‡∏≤‡∏Å‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</h2>
    <p>{{ service_intro }}</p>
</div>

<h2 class="text-secondary mb-3">üìÇ ‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ‡πÉ‡∏ô‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</h2>

{% for post in posts %}
<div class="post-container mb-4 p-3 border rounded bg-white">
    <h4>
        {% if post.profile_picture %}
            <img src="{{ url_for('static', filename='uploads/' + post.profile_picture) }}"
                 alt="Profile" style="width: 40px; height: 40px; object-fit: cover; border-radius: 50%;">
        {% else %}
            <img src="{{ url_for('static', filename='uploads/default_profile.png') }}"
                 alt="Default Profile" style="width: 40px; height: 40px; object-fit: cover; border-radius: 50%;">
        {% endif %}
        {{ post.title }}
    </h4>

    <p class="text-muted">üßë ‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÇ‡∏î‡∏¢: {{ post.author }} (‡∏£‡∏∞‡∏î‡∏±‡∏ö: {{ post.rank }})</p>

    <div class="mb-2" style="white-space: pre-line;">{{ post.content|safe }}</div>

    {% if post_images[post.title] %}
    <div class="mb-2">
        <p class="mb-1">üñºÔ∏è ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏ö:</p>
        {% for image_file in post_images[post.title] %}
            <img src="{{ url_for('static', filename='uploads/' + post.title + '/' + image_file) }}"
                 alt="Attached Image" class="img-thumbnail me-2 mb-2" style="max-width: 300px;">
        {% endfor %}
    </div>
    {% endif %}

    <a href="{{ url_for('post_actions', service_id=service_id, post_title=post.title) }}" class="btn btn-outline-primary btn-sm mt-2">üìñ ‡∏≠‡πà‡∏≤‡∏ô‡∏ï‡πà‡∏≠</a>
</div>
{% endfor %}

{% endblock %}
